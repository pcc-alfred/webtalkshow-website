---
import '../styles/global.css'
import SearchModal from '../components/SearchModal.astro'

interface Props {
  title: string
  description?: string
  image?: string
  transparentHeader?: boolean
}

const { title, description = "The Web Talk Show - Learn what happens 'behind-the-scenes' in the day-to-day of different industries, and get inspired with what's possible.", image = '/og-image.jpg', transparentHeader = false } = Astro.props
const canonicalUrl = new URL(Astro.url.pathname, Astro.site)
const absoluteImageUrl = new URL(image, Astro.site).toString()
---

<!doctype html>
<html lang="en" dir="ltr" class="scroll-smooth dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#e63329" />
    <link rel="canonical" href={canonicalUrl} />
    
    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={absoluteImageUrl} />
    <meta property="og:site_name" content="The Web Talk Show" />
    <meta property="og:locale" content="en_US" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={absoluteImageUrl} />
    
    <!-- Additional SEO -->
    <meta name="author" content="Armando J. Perez-Carreno" />
    <meta name="robots" content="index, follow" />
    <link rel="alternate" type="application/rss+xml" title="The Web Talk Show RSS Feed" href="/rss.xml" />
    
    <!-- Fonts: Syne (display) + DM Sans (body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet" />
    
    <title>{title}</title>
    
    <!-- JSON-LD: PodcastSeries -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "PodcastSeries",
      "name": "The Web Talk Show",
      "description": "Learn what happens 'behind-the-scenes' in the day-to-day of different industries, and get inspired with what's possible.",
      "url": "https://webtalk.show",
      "image": "https://webtalk.show/og-image.jpg",
      "author": {
        "@type": "Person",
        "name": "Armando J. Perez-Carreno",
        "url": "https://perezcarreno.com",
        "description": "Armando helps business owners eliminate operational bottlenecks and scale profitably through custom AI automation tailored to their specific workflows."
      },
      "publisher": {
        "@type": "Organization",
        "name": "The Web Talk Show",
        "logo": {
          "@type": "ImageObject",
          "url": "https://webtalk.show/logo.jpg"
        }
      },
      "webFeed": "https://webtalk.show/rss.xml",
      "inLanguage": "en"
    })} />

    <!-- JSON-LD: WebSite with SearchAction (sitelinks search box) -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "The Web Talk Show",
      "url": "https://webtalk.show",
      "description": "Learn what happens 'behind-the-scenes' in the day-to-day of different industries, and get inspired with what's possible.",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://webtalk.show/search?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    })} />
    
    <!-- Dark mode script -->
    <script is:inline>
      if (localStorage.theme === 'light') {
        document.documentElement.classList.remove('dark')
        document.documentElement.classList.add('light')
      }
    </script>

    <!-- Microsoft Clarity -->
    <script is:inline>
      (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "vfez29iglq");
    </script>
  </head>
  <body class="min-h-screen flex flex-col font-[var(--font-sans)] transition-colors" style="background-color: var(--bg); color: var(--text);">
    <!-- Skip to main content -->
    <a 
      href="#main-content" 
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:px-4 focus:py-2 focus:bg-[#e63329] focus:text-white focus:rounded-lg focus:outline-none"
    >
      Skip to main content
    </a>
    
    <!-- Header -->
    <header 
      id="site-header"
      class:list={[
        "fixed top-0 left-0 right-0 z-50 transition-all duration-300",
        transparentHeader ? "header-transparent" : "header-solid"
      ]}
    >
      <nav id="header-nav" class="max-w-6xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
        <a href="/" class="flex items-center gap-3 group">
          <img src="/logo.jpg" alt="The Web Talk Show" class="w-9 h-9 rounded-lg object-cover ring-1 ring-white/10" />
          <span class="header-link font-[var(--font-display)] font-bold text-lg hidden sm:inline tracking-tight">The Web Talk Show</span>
        </a>
        
        <div class="flex items-center gap-5">
          <a href="/episodes" class="header-link text-sm font-medium transition-colors hover:text-[#e63329]">Episodes</a>
          <button 
            type="button"
            onclick="openSearch()"
            aria-label="Open search (Press Command K)"
            class="header-link text-sm font-medium flex items-center gap-2 transition-colors hover:text-[#e63329]"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="hidden sm:inline">Search</span>
            <kbd class="header-kbd hidden md:inline-flex items-center gap-0.5 px-1.5 py-0.5 text-xs rounded">
              <span class="text-xs">‚åò</span>K
            </kbd>
          </button>
          <a href="/about" class="header-link text-sm font-medium transition-colors hover:text-[#e63329] hidden sm:inline">About</a>
          
          <!-- Dark mode toggle -->
          <button 
            type="button"
            id="theme-toggle"
            class="header-link p-2 hover:text-[#e63329] rounded-lg transition-colors"
            aria-label="Toggle dark mode"
          >
            <svg class="w-4 h-4 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg class="w-4 h-4 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
          </button>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-1" role="main">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="border-t mt-auto relative overflow-hidden" style="background-color: var(--bg-footer); border-color: var(--border);">
      <!-- Waveform decoration -->
      <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-[#e63329]/30 to-transparent"></div>
      <svg class="absolute top-4 left-0 w-full h-12 opacity-[0.04]" viewBox="0 0 1440 48" preserveAspectRatio="none">
        <path d="M0 24 Q180 0 360 24 Q540 48 720 24 Q900 0 1080 24 Q1260 48 1440 24" stroke="#e63329" stroke-width="2" fill="none"/>
      </svg>
      
      <div class="max-w-6xl mx-auto px-4 sm:px-6 py-12 relative z-10">
        <div class="grid md:grid-cols-3 gap-8">
          <div>
            <h3 class="text-white font-[var(--font-display)] font-bold text-lg mb-4">The Web Talk Show</h3>
            <p class="text-sm text-[#8a8a8a]">Behind-the-scenes conversations about technology, business, and the people who build things.</p>
          </div>
          <div>
            <h3 class="text-white font-semibold text-sm uppercase tracking-wider mb-4">Browse</h3>
            <div class="flex flex-col gap-2 text-sm">
              <a href="/episodes" class="text-[#8a8a8a] hover:text-white transition-colors">All Episodes</a>
              <a href="/topics" class="text-[#8a8a8a] hover:text-white transition-colors">Topics</a>
              <a href="/guests" class="text-[#8a8a8a] hover:text-white transition-colors">Guests</a>
              <a href="/about" class="text-[#8a8a8a] hover:text-white transition-colors">About</a>
              <a href="/rss.xml" class="text-[#8a8a8a] hover:text-orange-400 transition-colors">RSS Feed</a>
            </div>
          </div>
          <div>
            <h3 class="text-white font-semibold text-sm uppercase tracking-wider mb-4">Connect</h3>
            <div class="flex flex-col gap-2 text-sm">
              <a href="https://x.com/perezcarreno" target="_blank" rel="noopener noreferrer" class="text-[#8a8a8a] hover:text-white transition-colors">ùïè / Twitter</a>
              <a href="https://www.youtube.com/@perezcarreno" target="_blank" rel="noopener noreferrer" class="text-[#8a8a8a] hover:text-[#FF0000] transition-colors">YouTube</a>
              <a href="https://www.linkedin.com/in/armandoperezcarreno/" target="_blank" rel="noopener noreferrer" class="text-[#8a8a8a] hover:text-[#0A66C2] transition-colors">LinkedIn</a>
            </div>
          </div>
        </div>
        <div class="border-t border-white/10 mt-8 pt-8 text-sm text-center text-[#8a8a8a]">
          <p>&copy; {new Date().getFullYear()} The Web Talk Show. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- Search Modal -->
    <SearchModal />
    
    <!-- Scripts -->
    <script>
      // Dark mode toggle
      const themeToggle = document.getElementById('theme-toggle');
      themeToggle?.addEventListener('click', () => {
        const isCurrentlyDark = document.documentElement.classList.contains('dark');
        if (isCurrentlyDark) {
          document.documentElement.classList.remove('dark');
          document.documentElement.classList.add('light');
          localStorage.theme = 'light';
        } else {
          document.documentElement.classList.remove('light');
          document.documentElement.classList.add('dark');
          localStorage.theme = 'dark';
        }
      });

      // Transparent header scroll behavior
      const header = document.getElementById('site-header');
      if (header?.classList.contains('header-transparent')) {
        const onScroll = () => {
          if (window.scrollY > 50) {
            header.classList.add('header-scrolled');
          } else {
            header.classList.remove('header-scrolled');
          }
        };
        window.addEventListener('scroll', onScroll, { passive: true });
        onScroll();
      }
    </script>
  </body>
</html>

<!-- styles in global.css -->
